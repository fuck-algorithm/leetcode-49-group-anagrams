# 设计文档

## 概述

本项目是一个基于TypeScript + React + D3.js的算法演示网站，用于可视化展示LeetCode第49题"字母异位词分组"算法的执行过程。网站采用单页面应用架构，支持分步骤演示、代码调试效果、交互式画布等功能。

## 架构

### 技术栈

- **前端框架**: React 18 + TypeScript
- **可视化库**: D3.js
- **构建工具**: Vite
- **样式方案**: CSS Modules
- **部署平台**: GitHub Pages
- **CI/CD**: GitHub Actions

### 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                        App Container                         │
├─────────────────────────────────────────────────────────────┤
│  Header (标题 + GitHub徽标)                                  │
├─────────────────────────────────────────────────────────────┤
│  InputPanel (数据输入区域)                                   │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────┐  ┌─────────────────────────────┐  │
│  │                     │  │                             │  │
│  │    CodePanel        │  │       Canvas                │  │
│  │    (代码展示)        │  │       (D3.js可视化)         │  │
│  │                     │  │                             │  │
│  └─────────────────────┘  └─────────────────────────────┘  │
├─────────────────────────────────────────────────────────────┤
│  ControlPanel (播放控制 + 进度条)                            │
├─────────────────────────────────────────────────────────────┤
│  WeChatFloat (微信悬浮球)                                    │
└─────────────────────────────────────────────────────────────┘
```

## 组件与接口

### 核心组件

#### 1. App
- 根组件，管理全局状态
- 协调各子组件之间的通信

#### 2. Header
- 显示页面标题，链接到LeetCode
- 显示GitHub徽标，链接到仓库

#### 3. InputPanel
- 用户数据输入框
- 内置样例选择
- 随机生成按钮
- 数据验证

#### 4. CodePanel
- 显示Java算法代码
- 行号显示
- 当前行高亮
- 变量值内联显示
- 语法高亮

#### 5. Canvas
- D3.js渲染的可视化画布
- 支持拖拽平移
- 支持缩放
- 显示字符串数组和分组结果
- 动画效果

#### 6. ControlPanel
- 播放/暂停按钮
- 上一步/下一步按钮
- 重置按钮
- 进度条
- 快捷键支持

#### 7. WeChatFloat
- 悬浮球图标
- 悬停显示二维码

### 核心接口

```typescript
// 算法步骤
interface AlgorithmStep {
  stepIndex: number;
  lineNumber: number;
  description: string;
  variables: Record<string, any>;
  inputArray: string[];
  groups: Map<string, string[]>;
  currentString?: string;
  currentKey?: string;
  highlightedElements: string[];
}

// 播放状态
interface PlaybackState {
  currentStep: number;
  totalSteps: number;
  isPlaying: boolean;
  playbackSpeed: number;
}

// 输入数据
interface InputData {
  strings: string[];
  isValid: boolean;
  errorMessage?: string;
}

// 画布变换
interface CanvasTransform {
  x: number;
  y: number;
  scale: number;
}
```

## 数据模型

### 算法步骤生成

算法使用排序方法对字母异位词进行分组。步骤生成器会记录：

1. **初始化步骤**: 创建HashMap
2. **遍历步骤**: 对每个字符串
   - 获取当前字符串
   - 对字符串排序得到key
   - 将字符串添加到对应分组
3. **完成步骤**: 返回所有分组

### 变量追踪

追踪的变量包括：
- `strs`: 输入字符串数组
- `map`: HashMap<String, List<String>>
- `str`: 当前处理的字符串
- `key`: 排序后的字符串（作为分组键）
- `i`: 循环索引

## 正确性属性

*属性是一个在系统所有有效执行中都应该保持为真的特征或行为——本质上是关于系统应该做什么的形式化陈述。属性作为人类可读规范和机器可验证正确性保证之间的桥梁。*

### 属性1: 步骤导航一致性
*对于任意*当前步骤索引n（0 < n < totalSteps），执行"上一步"操作后步骤索引应为n-1，执行"下一步"操作后步骤索引应为n+1
**验证: 需求 4.1, 4.2**

### 属性2: 重置状态一致性
*对于任意*当前播放状态，执行"重置"操作后，步骤索引应为0，播放状态应为暂停
**验证: 需求 4.5**

### 属性3: 进度条同步
*对于任意*进度条位置p（0 <= p <= 1），拖动到该位置后，当前步骤索引应为floor(p * totalSteps)
**验证: 需求 5.3**

### 属性4: 代码行高亮同步
*对于任意*算法步骤，代码面板高亮的行号应与该步骤记录的lineNumber一致
**验证: 需求 2.2**

### 属性5: 变量显示同步
*对于任意*算法步骤，代码面板显示的变量值应与该步骤记录的variables一致
**验证: 需求 2.3**

### 属性6: 随机数据合法性
*对于任意*随机生成的数据，所有字符串应仅包含小写字母，数组长度应在[1, 10^4]范围内，每个字符串长度应在[0, 100]范围内
**验证: 需求 6.4**

### 属性7: 输入验证正确性
*对于任意*输入数据，如果包含非小写字母字符或超出长度限制，验证函数应返回false并提供错误信息
**验证: 需求 6.5, 6.6**

### 属性8: 步骤完整性
*对于任意*输入数据，生成的步骤序列应包含完整的算法执行过程，每个步骤应包含lineNumber、description、variables和当前数据状态
**验证: 需求 9.1, 9.2, 9.3**

### 属性9: 画布状态同步
*对于任意*算法步骤，画布上显示的分组状态应与该步骤记录的groups一致
**验证: 需求 3.4**

## 错误处理

### 输入验证错误
- 空输入: 显示"请输入字符串数组"
- 非法字符: 显示"字符串只能包含小写字母"
- 长度超限: 显示"数组长度或字符串长度超出限制"

### 运行时错误
- 步骤越界: 自动限制在有效范围内
- 画布渲染失败: 显示错误提示并提供重试选项

## 测试策略

### 单元测试

使用Vitest进行单元测试：
- 算法步骤生成器测试
- 输入验证函数测试
- 播放控制逻辑测试

### 属性测试

使用fast-check进行属性测试：
- 每个属性测试运行至少100次迭代
- 测试注释格式: `**Feature: group-anagrams-visualizer, Property {number}: {property_text}**`

### 端到端测试

使用Playwright进行E2E测试：
- 页面加载测试
- 用户交互测试
- 键盘快捷键测试
